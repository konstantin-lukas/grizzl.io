#!/usr/bin/env bash
set -e

SCRIPT_DIR="$(cd "$(dirname "$0")" && pwd)"
ENV=${1:-dev}

case "$ENV" in
  dev)
    docker volume ls -q | xargs -r docker volume rm
    docker compose -f compose.yml --env-file .env up -d
    "$SCRIPT_DIR/migrate"
    ;;
  test)
    CADDY_PORT=80 docker compose --env-file .env -f compose.test.yml up -d --build
    ;;
  *)
    echo "Unknown environment: $ENV"
    echo "Usage: $0 [dev|test]"
    exit 1
    ;;
esac